<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Prince Alex Airbnb, Uthiru</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; line-height: 1.6; color: #333; overflow-x: hidden; background: #f8f9fa; }
        
        .navbar { position: fixed; top: 0; width: 100%; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); z-index: 1000; padding: 1rem 0; transition: all 0.3s ease; box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1); }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
        .nav-logo h2 { font-family: 'Montserrat', sans-serif; color: #1a365d; font-size: 1.5rem; font-weight: 600; }
        .nav-logo span { color: #d4af37; font-size: 0.9rem; font-weight: 400; }
        .nav-menu { display: flex; align-items: center; gap: 2rem; }
        .nav-link { text-decoration: none; color: #333; font-weight: 500; transition: color 0.3s ease; position: relative; }
        .nav-link:hover, .nav-link.active { color: #d4af37; }
        .nav-link.active::after { content: ''; position: absolute; bottom: -5px; left: 0; width: 100%; height: 2px; background: #d4af37; }
        .login-btn { background: #d4af37; color: white !important; padding: 0.5rem 1.5rem; border-radius: 25px; transition: all 0.3s ease; }
        .login-btn:hover { background: #b8941f; transform: translateY(-2px); }
        .hamburger { display: none; flex-direction: column; cursor: pointer; z-index: 1001; }
        .hamburger span { width: 25px; height: 3px; background: #333; margin: 3px 0; transition: 0.3s; }
        .hamburger.active span:nth-child(1) { transform: rotate(-45deg) translate(-5px, 6px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(45deg) translate(-5px, -6px); }
        
        .auth-section { min-height: 100vh; padding: 100px 0 50px; display: flex; align-items: center; justify-content: center; }
        .auth-container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .auth-grid { display: grid; grid-template-columns: 1fr 1fr; min-height: 600px; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1); overflow: hidden; }
        .auth-welcome { background: linear-gradient(135deg, #1a365d, #2d5a87); color: white; padding: 3rem; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .welcome-content { position: relative; z-index: 2; text-align: center; max-width: 400px; }
        .welcome-content h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 1.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); }
        .welcome-content > p { font-size: 1.1rem; margin-bottom: 2rem; opacity: 0.9; line-height: 1.7; }
        .welcome-features { display: flex; flex-direction: column; gap: 1rem; margin-bottom: 3rem; }
        .feature-item { display: flex; align-items: center; gap: 1rem; padding: 0.8rem; background: rgba(255, 255, 255, 0.1); border-radius: 10px; backdrop-filter: blur(10px); transition: all 0.3s ease; }
        .feature-item:hover { background: rgba(255, 255, 255, 0.2); transform: translateX(10px); }
        .feature-icon { font-size: 1.5rem; width: 40px; text-align: center; }
        .feature-item span:last-child { font-size: 0.9rem; font-weight: 500; }
        .auth-switch { text-align: center; padding-top: 2rem; border-top: 1px solid rgba(255, 255, 255, 0.2); }
        .auth-switch p { margin-bottom: 0.8rem; opacity: 0.8; }
        .switch-link { color: #d4af37; text-decoration: none; font-weight: 600; font-size: 1.1rem; transition: all 0.3s ease; }
        .switch-link:hover { color: #b8941f; text-decoration: underline; }
        
        .auth-form-side { padding: 3rem; display: flex; align-items: center; justify-content: center; background: white; }
        .auth-form-container { width: 100%; max-width: 400px; }
        .form-header { text-align: center; margin-bottom: 2rem; }
        .form-header h2 { font-size: 2rem; font-weight: 600; color: #1a365d; margin-bottom: 0.5rem; }
        .form-header p { color: #666; font-size: 1rem; }
        .auth-form { display: flex; flex-direction: column; gap: 1.5rem; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: 500; color: #333; margin-bottom: 0.5rem; font-size: 0.9rem; }
        .form-group input { padding: 0.8rem; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1rem; font-family: 'Poppins', sans-serif; transition: all 0.3s ease; background: white; }
        .form-group input:focus { outline: none; border-color: #d4af37; box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1); transform: translateY(-2px); }
        .password-input { position: relative; }
        .password-toggle { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; padding: 5px; color: #666; transition: color 0.3s ease; }
        .password-toggle:hover { color: #d4af37; }
        .toggle-icon { font-size: 1.2rem; }
        .error-message { color: #dc3545; font-size: 0.8rem; margin-top: 0.3rem; display: none; }
        .error-message.show { display: block; }
        .forgot-password { text-align: right; margin-top: 0.5rem; }
        .forgot-link { color: #d4af37; text-decoration: none; font-size: 0.9rem; transition: color 0.3s ease; }
        .forgot-link:hover { color: #b8941f; text-decoration: underline; }
        .auth-btn { background: linear-gradient(135deg, #d4af37, #b8941f); color: white; border: none; padding: 1rem 2rem; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; margin-top: 1rem; min-height: 44px; }
        .auth-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3); }
        .auth-btn:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
        .auth-footer { text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #e9ecef; }
        .auth-footer p { font-size: 0.8rem; color: #666; line-height: 1.5; }
        .auth-footer a { color: #d4af37; text-decoration: none; }
        .auth-footer a:hover { text-decoration: underline; }
        
        .modal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); animation: fadeIn 0.3s ease; }
        .modal-content { position: relative; background-color: white; margin: 5% auto; padding: 2rem; width: 90%; max-width: 500px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); animation: slideInDown 0.3s ease; max-height: 80vh; overflow-y: auto; }
        .close-modal { position: absolute; top: 1rem; right: 1.5rem; font-size: 2rem; cursor: pointer; color: #666; transition: color 0.3s ease; }
        .close-modal:hover { color: #333; }
        .success-header { text-align: center; margin-bottom: 2rem; }
        .success-icon { font-size: 4rem; margin-bottom: 1rem; }
        .success-header h2 { color: #28a745; font-size: 1.8rem; margin-bottom: 0.5rem; }
        .success-header p { color: #666; font-size: 1.1rem; }
        .success-details { margin-bottom: 2rem; text-align: left; }
        .success-info { background: #f8f9fa; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #d4af37; }
        .success-info p { color: #333; margin-bottom: 1rem; font-size: 0.95rem; line-height: 1.6; display: flex; align-items: flex-start; gap: 0.5rem; }
        .success-info p:last-child { margin-bottom: 0; }
        .success-actions { display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; }
        .primary-btn { background: #d4af37; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease; min-height: 44px; }
        .primary-btn:hover { background: #b8941f; transform: translateY(-2px); }
        .secondary-btn { background: #6c757d; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease; min-height: 44px; }
        .secondary-btn:hover { background: #5a6268; transform: translateY(-2px); }
        
        .footer { background: #1a1a1a; color: white; padding: 3rem 0 1rem; margin-top: 4rem; }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 2rem; }
        .footer-section h3, .footer-section h4 { margin-bottom: 1rem; color: #d4af37; }
        .footer-section p, .footer-section li { margin-bottom: 0.5rem; opacity: 0.8; }
        .footer-section ul { list-style: none; }
        .footer-section a { color: white; text-decoration: none; opacity: 0.8; transition: opacity 0.3s ease; }
        .footer-section a:hover { opacity: 1; color: #d4af37; }
        .social-links { display: flex; gap: 1rem; margin-top: 1rem; }
        .social-links a { font-size: 1.5rem; transition: transform 0.3s ease; }
        .social-links a:hover { transform: scale(1.2); }
        .footer-bottom { text-align: center; padding-top: 2rem; border-top: 1px solid #333; opacity: 0.6; }
        .designer-credit { margin-top: 0.5rem; font-size: 0.9rem; }
        .designer-credit a { color: #d4af37; text-decoration: none; font-weight: 500; transition: all 0.3s ease; }
        .designer-credit a:hover { color: #b8941f; text-decoration: underline; }
        
        @media (max-width: 1024px) { .auth-grid { grid-template-columns: 1fr; max-width: 500px; margin: 0 auto; } .auth-welcome { order: 2; padding: 2rem; } .auth-form-side { order: 1; padding: 2rem; } .welcome-content h1 { font-size: 2rem; } }
        @media (max-width: 768px) { .hamburger { display: flex; } .nav-menu { position: fixed; left: -100%; top: 70px; flex-direction: column; background: white; width: 100%; text-align: center; transition: 0.3s; box-shadow: 0 10px 27px rgba(0, 0, 0, 0.05); padding: 2rem 0; } .nav-menu.active { left: 0; } .auth-section { padding: 80px 0 30px; } }
        @media (max-width: 480px) { .auth-welcome, .auth-form-side { padding: 1.5rem; } .welcome-content h1 { font-size: 1.8rem; } .form-header h2 { font-size: 1.5rem; } }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .auth-form-container, .welcome-content { animation: fadeInUp 0.6s ease forwards; }
        .form-group input.error { border-color: #dc3545; box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1); }
        .form-group input.success { border-color: #28a745; box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1); }
        
        @media (max-width: 768px) { button, .btn, .auth-btn, .nav-link, input[type="submit"], input[type="button"] { min-height: 44px; min-width: 44px; touch-action: manipulation; } body { font-size: 16px; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; } input, select, textarea { font-size: 16px; border-radius: 8px; padding: 1rem; } }
        html { scroll-behavior: smooth; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>Prince Alex Airbnb</h2>
                <span>Uthiru, Nairobi</span>
            </div>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">Home</a>
                <a href="listings.html" class="nav-link">Rooms</a>
                <a href="about.html" class="nav-link">About</a>
                <a href="contact.html" class="nav-link">Contact</a>
                <a href="login.html" class="nav-link login-btn active">Login</a>
            </div>
            <div class="hamburger"><span></span><span></span><span></span></div>
        </div>
    </nav>

    <section class="auth-section">
        <div class="auth-container">
            <div class="auth-grid">
                <div class="auth-welcome">
                    <div class="welcome-content">
                        <h1>Welcome Back!</h1>
                        <p>Sign in to your Prince Alex Airbnb account to manage your bookings and enjoy personalized recommendations.</p>
                        <div class="welcome-features">
                            <div class="feature-item"><span class="feature-icon">🏠</span><span>Manage your bookings</span></div>
                            <div class="feature-item"><span class="feature-icon">💰</span><span>View payment history</span></div>
                            <div class="feature-item"><span class="feature-icon">⭐</span><span>Leave reviews</span></div>
                            <div class="feature-item"><span class="feature-icon">🎯</span><span>Get personalized offers</span></div>
                        </div>
                        <div class="auth-switch">
                            <p>Don't have an account?</p>
                            <a href="register.html" class="switch-link">Create account here</a>
                        </div>
                    </div>
                </div>

                <div class="auth-form-side">
                    <div class="auth-form-container">
                        <div class="form-header">
                            <h2>Sign In</h2>
                            <p>Enter your credentials to access your account</p>
                        </div>

                        <form id="login-form" class="auth-form">
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" name="email" required>
                                <span class="error-message" id="email-error"></span>
                            </div>

                            <div class="form-group">
                                <label for="password">Password</label>
                                <div class="password-input">
                                    <input type="password" id="password" name="password" required>
                                    <button type="button" class="password-toggle" onclick="togglePassword('password')">
                                        <span class="toggle-icon">👁️</span>
                                    </button>
                                </div>
                                <span class="error-message" id="password-error"></span>
                                <div class="forgot-password">
                                    <a href="#" class="forgot-link" onclick="showForgotPassword()">Forgot Password?</a>
                                </div>
                            </div>

                            <button type="submit" class="auth-btn">
                                <span class="btn-text">Sign In</span>
                                <span class="btn-loader" style="display: none;">Signing in...</span>
                            </button>
                        </form>

                        <div class="auth-footer">
                            <p>By signing in, you agree to our <a href="#" onclick="showTerms()">Terms of Service</a> and <a href="#" onclick="showPrivacy()">Privacy Policy</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Prince Alex Airbnb</h3>
                    <p>Your home away from home in Uthiru, Nairobi</p>
                    <div class="social-links">
                        <a href="#" aria-label="Facebook">📘</a>
                        <a href="#" aria-label="Instagram">📷</a>
                        <a href="#" aria-label="WhatsApp">📱</a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="listings.html">Rooms</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact Info</h4>
                    <p>📍 Uthiru, Nairobi, Kenya</p>
                    <p>📞 +254 717 384 875</p>
                    <p>✉️ princealexdigital@gmail.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Prince Alex Airbnb. All rights reserved.</p>
                <p class="designer-credit">Designed by <a href="https://www.princealex.pro" target="_blank" rel="noopener">Prince Alex Digital</a></p>
            </div>
        </div>
    </footer>

    <div id="forgot-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeForgotModal()">&times;</span>
            <div class="form-header">
                <h2>Reset Password</h2>
                <p>Enter your email to receive a password reset link</p>
            </div>
            <form id="forgot-form" class="auth-form">
                <div class="form-group">
                    <label for="forgot-email">Email Address</label>
                    <input type="email" id="forgot-email" name="email" required>
                    <span class="error-message" id="forgot-email-error"></span>
                </div>
                <button type="submit" class="auth-btn">
                    <span class="btn-text">Send Reset Link</span>
                    <span class="btn-loader" style="display: none;">Sending...</span>
                </button>
            </form>
        </div>
    </div>

    <div id="success-modal" class="modal">
        <div class="modal-content">
            <div class="success-header">
                <div class="success-icon">🎉</div>
                <h2 id="success-title">Welcome Back!</h2>
                <p id="success-message">You have successfully signed in to your account</p>
            </div>
            <div class="success-details">
                <div class="success-info">
                    <p>🏠 <strong>Ready to explore?</strong> Browse our beautiful rooms in Uthiru, Nairobi</p>
                    <p>👤 <strong>Manage your profile</strong> Update your preferences and view booking history</p>
                    <p>📱 <strong>Need help?</strong> Contact us anytime on WhatsApp: +254 717 384 875</p>
                </div>
            </div>
            <div class="success-actions">
                <button class="primary-btn" onclick="closeSuccessModal()">Continue to Dashboard</button>
                <button class="secondary-btn" onclick="goToRooms()">Browse Rooms</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <script>
        const firebaseConfig = { apiKey: "AIzaSyAUNs3WYS2mkvPvzRDfhyZFUbP2XpZjDQg", authDomain: "retailflow-pos-11726.firebaseapp.com", projectId: "retailflow-pos-11726", storageBucket: "retailflow-pos-11726.firebasestorage.app", messagingSenderId: "309314798354", appId: "1:309314798354:web:30784c2b2e7e42168629cb" };
        let firebaseApp, auth, db, currentUser, isSubmitting = false;

        function initializeFirebase() {
            if (typeof firebase !== 'undefined') {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                auth.onAuthStateChanged((user) => { currentUser = user; });
                return true;
            }
            return false;
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (typeof firebase !== 'undefined') { initializeFirebase(); } else { setTimeout(() => initializeFirebase(), 1000); }
            initializeMobileNavigation();
            initializeFormValidation();
        });

        function initializeMobileNavigation() {
            const hamburger = document.querySelector('.hamburger');
            const navMenu = document.querySelector('.nav-menu');
            const body = document.body;
            if (hamburger && navMenu) {
                hamburger.addEventListener('click', function(e) {
                    e.stopPropagation();
                    navMenu.classList.toggle('active');
                    hamburger.classList.toggle('active');
                    body.style.overflow = navMenu.classList.contains('active') ? 'hidden' : 'auto';
                });
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', () => {
                        navMenu.classList.remove('active');
                        hamburger.classList.remove('active');
                        body.style.overflow = 'auto';
                    });
                });
            }
        }

        function initializeFormValidation() {
            const form = document.getElementById('login-form');
            const inputs = form.querySelectorAll('input[required]');
            inputs.forEach(input => {
                input.addEventListener('blur', () => validateField(input));
                input.addEventListener('input', () => clearError(input));
            });
            form.addEventListener('submit', handleFormSubmit);
            const forgotForm = document.getElementById('forgot-form');
            if (forgotForm) { forgotForm.addEventListener('submit', handleForgotPasswordSubmit); }
        }

        function validateField(input) {
            const errorElement = document.getElementById(`${input.id}-error`);
            let isValid = true, errorMessage = '';
            if (input.hasAttribute('required') && !input.value.trim()) { isValid = false; errorMessage = `${input.getAttribute('placeholder') || 'This field'} is required`; }
            if (isValid && input.type === 'email' && input.value) {
                const emailRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
                if (!emailRegex.test(input.value)) { isValid = false; errorMessage = 'Please enter a valid email address (e.g., user@example.com)'; }
                else if (input.value.length > 254) { isValid = false; errorMessage = 'Email address is too long'; }
            }
            if (isValid && input.type === 'password' && input.value && input.id === 'password') {
                if (input.value.length < 6) { isValid = false; errorMessage = 'Password must be at least 6 characters long'; }
                else if (input.value.length > 128) { isValid = false; errorMessage = 'Password is too long'; }
            }
            if (errorElement) {
                if (isValid) { errorElement.textContent = ''; errorElement.classList.remove('show'); input.classList.remove('error'); if (input.value.trim()) { input.classList.add('success'); } }
                else { errorElement.textContent = errorMessage; errorElement.classList.add('show'); input.classList.add('error'); input.classList.remove('success'); }
            }
            return isValid;
        }

        function clearError(input) { const errorElement = document.getElementById(`${input.id}-error`); if (errorElement) { errorElement.classList.remove('show'); input.classList.remove('error'); } }

        async function handleFormSubmit(event) {
            event.preventDefault();
            if (isSubmitting) return;
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            let isValid = true;
            if (!validateField(emailInput)) isValid = false;
            if (!validateField(passwordInput)) isValid = false;
            if (!isValid) { showNotification('❌ Please check your email and password fields and try again', 'error'); return; }
            isSubmitting = true;
            updateSubmitButton(true);
            try {
                const userCredential = await auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value);
                if (db && userCredential.user) {
                    try { await db.collection('customers').doc(userCredential.user.uid).update({ lastLoginAt: firebase.firestore.FieldValue.serverTimestamp() }); } catch (updateError) { console.log('Note: Could not update last login time:', updateError); }
                }
                showSuccessModal();
                setTimeout(() => {
                    const returnUrl = sessionStorage.getItem('returnUrl') || 'profile.html';
                    sessionStorage.removeItem('returnUrl');
                    window.location.href = returnUrl;
                }, 2000);
            } catch (error) {
                console.error('Login error details:', { code: error.code, message: error.message, email: emailInput.value, timestamp: new Date().toISOString() });
                const errorMessage = getFirebaseErrorMessage(error.code);
                showNotification(errorMessage, 'error');
                if (error.code === 'auth/user-not-found' || error.code?.includes('user-not-found')) {
                    setTimeout(() => { showNotification('💭 Don\'t have an account yet? Click "Create Account" below to register.', 'info'); }, 3000);
                } else if (error.code === 'auth/wrong-password' || error.code?.includes('wrong-password') || error.code === 'auth/invalid-credential') {
                    setTimeout(() => { showNotification('🔑 Trouble remembering your password? Try the "Forgot Password?" link.', 'info'); }, 3000);
                }
            }
            isSubmitting = false;
            updateSubmitButton(false);
        }

        async function handleForgotPasswordSubmit(event) {
            event.preventDefault();
            const emailInput = document.getElementById('forgot-email');
            if (!validateField(emailInput)) { showNotification('Please enter a valid email address', 'error'); return; }
            updateForgotButton(true);
            try {
                await auth.sendPasswordResetEmail(emailInput.value);
                showNotification('✅ Password reset link sent! Please check your email inbox and follow the instructions to reset your password.', 'success');
                closeForgotModal();
            } catch (error) { showNotification(getFirebaseErrorMessage(error.code), 'error'); }
            updateForgotButton(false);
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const toggleIcon = input.parentElement.querySelector('.toggle-icon');
            if (input.type === 'password') { input.type = 'text'; toggleIcon.textContent = '🙈'; } else { input.type = 'password'; toggleIcon.textContent = '👁️'; }
        }

        function updateSubmitButton(loading) {
            const button = document.querySelector('.auth-btn');
            const btnText = button.querySelector('.btn-text');
            const btnLoader = button.querySelector('.btn-loader');
            if (loading) { button.disabled = true; btnText.style.display = 'none'; btnLoader.style.display = 'inline-block'; }
            else { button.disabled = false; btnText.style.display = 'inline-block'; btnLoader.style.display = 'none'; }
        }

        function updateForgotButton(loading) {
            const button = document.querySelector('#forgot-form .auth-btn');
            if (!button) return;
            const btnText = button.querySelector('.btn-text');
            const btnLoader = button.querySelector('.btn-loader');
            if (loading) { button.disabled = true; btnText.style.display = 'none'; btnLoader.style.display = 'inline-block'; }
            else { button.disabled = false; btnText.style.display = 'inline-block'; btnLoader.style.display = 'none'; }
        }

        function showForgotPassword() { document.getElementById('forgot-modal').style.display = 'block'; document.body.style.overflow = 'hidden'; }
        function closeForgotModal() { document.getElementById('forgot-modal').style.display = 'none'; document.body.style.overflow = 'auto'; document.getElementById('forgot-form').reset(); clearError(document.getElementById('forgot-email')); }

        function showSuccessModal() {
            if (currentUser) {
                const displayName = currentUser.displayName;
                const firstName = displayName ? displayName.split(' ')[0] : 'User';
                document.getElementById('success-title').textContent = `Welcome Back, ${firstName}!`;
                document.getElementById('success-message').textContent = `Great to see you again! You're now signed in and ready to explore.`;
            }
            document.getElementById('success-modal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            setTimeout(() => { showNotification('🎉 Login successful! Welcome to Prince Alex Airbnb', 'success'); }, 500);
        }

        function closeSuccessModal() { document.getElementById('success-modal').style.display = 'none'; document.body.style.overflow = 'auto'; }
        function goToRooms() { closeSuccessModal(); window.location.href = 'listings.html'; }
        function showTerms() { showNotification('Terms of Service - Please contact us for details', 'info'); }
        function showPrivacy() { showNotification('Privacy Policy - Please contact us for details', 'info'); }

        function getFirebaseErrorMessage(errorCode) {
            switch (errorCode) {
                case 'auth/user-not-found': return '❌ No account found with this email address.\n💡 Please check your email spelling or create a new account using the "Sign up" link below.';
                case 'auth/wrong-password': return '❌ Incorrect password entered.\n💡 Please check your password carefully. You can use "Forgot Password?" if you need to reset it.';
                case 'auth/invalid-email': return '❌ Invalid email format.\n💡 Please enter a valid email address (example: user@domain.com).';
                case 'auth/user-disabled': return '❌ This account has been disabled.\n💡 Please contact our support team at +254 717 384 875 for assistance.';
                case 'auth/too-many-requests': return '❌ Too many failed login attempts detected.\n💡 Please wait 5-10 minutes before trying again, or use "Forgot Password?" to reset your password.';
                case 'auth/network-request-failed': return '❌ Network connection error.\n💡 Please check your internet connection and try again. If the problem persists, contact support.';
                case 'auth/invalid-credential':
                case 'auth/invalid-login-credentials':
                case 'auth/user-mismatch': return '❌ Email or password is incorrect.\n💡 Please double-check both your email and password. Make sure Caps Lock is off and try again.';
                default:
                    console.error('Unhandled Firebase error code:', errorCode);
                    if (errorCode && (errorCode.includes('auth/') || errorCode.includes('credential') || errorCode.includes('invalid'))) {
                        return '❌ Email or password is incorrect.\n💡 Please check your email and password carefully. If you\'re sure they\'re correct, try "Forgot Password?" to reset.';
                    }
                    return `❌ Login failed.\n💡 Please check your email and password. If the problem continues, contact support at +254 717 384 875.\n🔧 Error details: ${errorCode}`;
            }
        }

        function showNotification(message, type = 'info') {
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());
            const formattedMessage = message.replace(/\n/g, '<br>');
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `<div class="notification-content"><span class="notification-icon">${getNotificationIcon(type)}</span><span class="notification-message">${formattedMessage}</span><button class="notification-close" onclick="this.parentElement.parentElement.remove()">&times;</button></div>`;
            const isError = type === 'error';
            const notificationWidth = isError ? '450px' : '400px';
            const notificationPadding = isError ? '1.5rem' : '1rem';
            notification.style.cssText = `position: fixed; top: 100px; right: 20px; background: ${getNotificationColor(type)}; color: white; padding: ${notificationPadding}; border-radius: 12px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2); z-index: 10000; min-width: 300px; max-width: ${notificationWidth}; animation: slideInRight 0.3s ease; border: ${isError ? '2px solid #dc3545' : 'none'};`;
            const content = notification.querySelector('.notification-content');
            content.style.cssText = `display: flex; align-items: center; gap: 10px;`;
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.style.cssText = `background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; margin-left: auto; padding: 0 5px;`;
            document.body.appendChild(notification);
            const displayTime = isError ? 8000 : 5000;
            setTimeout(() => { if (notification.parentElement) { notification.style.animation = 'slideOutRight 0.3s ease'; setTimeout(() => notification.remove(), 300); } }, displayTime);
        }

        function getNotificationIcon(type) { switch(type) { case 'success': return '✓'; case 'error': return '✗'; case 'warning': return '⚠'; default: return 'ℹ'; } }
        function getNotificationColor(type) { switch(type) { case 'success': return '#28a745'; case 'error': return '#dc3545'; case 'warning': return '#ffc107'; default: return '#007bff'; } }

        window.addEventListener('click', function(event) { const modals = document.querySelectorAll('.modal'); modals.forEach(modal => { if (event.target === modal) { modal.style.display = 'none'; document.body.style.overflow = 'auto'; } }); });
        document.addEventListener('keydown', function(event) { if (event.key === 'Escape') { const modals = document.querySelectorAll('.modal'); modals.forEach(modal => { if (modal.style.display === 'block') { modal.style.display = 'none'; document.body.style.overflow = 'auto'; } }); } });

        const style = document.createElement('style');
        style.textContent = `@keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } } @keyframes slideOutRight { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }`;
        document.head.appendChild(style);
    </script>
</body>
</html>
